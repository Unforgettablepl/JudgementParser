from translater import flores_codes
from pdfParser import extractRawText
from gptCleaner import getCleanText
from htmlTranslater import translateHTML
import weasyprint
import os

# inp = input("Enter the path to the pdf file: ")
# tgt_lang = input("Enter the language to be translated into: ")
inp = "/mnt/c/Users/Samik Goyal/Documents/sc_writ_3.pdf"
tgt_lang = "pan_Guru"

if tgt_lang not in flores_codes:
    raise "Language code not supported"

rawText = extractRawText(inp)
print("Raw text extracted from pdf:")
print(rawText)
print("----------------------------")

cleanText = getCleanText(rawText).strip()
if not cleanText.startswith("```html") or not cleanText.endswith("```"):
    raise "Invalid output by GPT"
cleanText = cleanText[7:-3]
print("Clean text generated by GPT:")
print(cleanText)
print("----------------------------")

with open("output_en.html", "w") as f:
    f.write(cleanText)
print("Source HTML generated successfully")

translatedText = translateHTML(cleanText, tgt_lang)
print("Translated text:")
print(translatedText)
print("----------------------------")

with open("output.html", "w") as f:
    f.write(translatedText)
print("HTML generated successfully")

weasyprint.HTML(string=translatedText).write_pdf("output.pdf")
print("PDF generated successfully")